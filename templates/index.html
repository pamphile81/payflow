{% extends "base.html" %}
{% block title %}Accueil · PayFlow{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-12 col-lg-7">
    <div class="card shadow-sm">
      <div class="card-body">
        <h1 class="h4 mb-3">Importer un bulletin PDF (multi-pages)</h1>
        <p class="text-secondary">
          Chargez votre fichier PDF contenant l’ensemble des fiches. PayFlow segmentera,
          protégera chaque fiche par matricule, créera un lien sécurisé et enverra l’email.
        </p>

        <form id="uploadForm" action="{{ url_for('public.upload_file') }}" method="post" enctype="multipart/form-data">
          <div class="mb-3">
            <label class="form-label">Fichier PDF</label>
            <input class="form-control" type="file" name="file" accept="application/pdf" required>
          </div>

          <div class="d-flex gap-2">
            <button id="btnUpload" class="btn btn-primary" type="submit">
              <span id="upSpin" class="spinner" style="display:none;"></span>
              Lancer le traitement
            </button>
            <a class="btn btn-outline-light" href="{{ url_for('public.index') }}">Réinitialiser</a>
          </div>
        </form>

        <div id="uploadHint" class="form-text mt-3 text-secondary">
          Astuce : le traitement crée des dossiers datés dans <code>uploads/</code> et <code>output/</code>.
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="h5">Téléchargement sécurisé d’une fiche</h2>
        <p class="text-secondary mb-2">
          Si vous avez reçu un email avec un lien sécurisé, collez-le directement dans votre navigateur.
        </p>
        <ul class="mb-0 text-secondary">
          <li>Le lien expire automatiquement (configuration côté serveur).</li>
          <li>Le matricule est requis pour valider le téléchargement.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const form = document.getElementById('uploadForm');
  const btn = document.getElementById('btnUpload');
  const spin = document.getElementById('upSpin');

  form?.addEventListener('submit', () => {
    btn.disabled = true;
    spin.style.display = 'inline-block';
  });
</script>
{% endblock %}
